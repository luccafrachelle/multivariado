---
title: "Entrega 1 Analisis Multivariado I"
author: "Lucca Frachelle , Joaquín Silva , Cecilia Waksman"
format: pdf
editor: visual
echo: false
warning: false
---

# Resumen Ejecutivo

Los datos utilizados en este análisis surgen de un estudio epidemiológico llevado a cabo en la Facultad de Odontología de la Universidad de la República, Uruguay, durante el período 2015-2016. Los mismos son recogidos de 602 individuos que acudieron a consulta. Este análisis se centra mayormente en el uso de variables binarias para identificar la presencia de enfermedades no transmisibles (ENT) y otros factores de riesgo asociados con la salud bucal, tratados aquí como comorbilidades. Los atributos estudiados se agrupan en tres bloques principales: comportamentales, ENT generales, y patologías odontológicas específicas, además se cuenta con variables demográficas diversas (edad, ingreso, sexo, nivel educativo). Entre los comportamentales se incluyen el consumo diario de tabaco, el consumo nocivo de alcohol y la insuficiencia de actividad física. Los ENT se refieren a condiciones como sobrepeso/obesidad, razón de cintura-cadera, hipertensión y diabetes. Finalmente, las condiciones odontológicas incluyen la prevalencia de bolsas periodontales, pérdida dentaria, caries y prevalencia de patología periapical infecciosa (PIP).

El estudio empleó técnicas de muestreo sistemático para seleccionar una muestra representativa, ajustada para medir prevalencias de hasta un 25% con un margen de error de 0.05 y un nivel de confianza del 95%. Se aplicaron cuestionarios sociodemográficos y exámenes bucodentales completos, evaluando la salud dental y de la mucosa, además de medidas antropométricas y análisis de presión arterial y glucemia.

# Introducción

En el presente trabajo, aprovechamos un conjunto de datos derivados de individuos que solicitaron atención en la Facultad de Odontología de la Universidad de la República, Uruguay, entre 2015 y 2016, para realizar un estudio exploratorio que indaga cómo los factores de riesgo comportamentales y las enfermedades no transmisibles (ENT) influyen en las patologías odontológicas. A través del uso de del Análisis de Componentes (CA) y Análisis de Correspondencias Múltiples (MCA), buscamos comprender las interacciones y posibles correlaciones entre estos distintos aspectos de la salud.

Este trabajo se centra en analizar las asociaciones entre variables, con el fin de identificar patrones que sugieran cómo los hábitos de vida y las condiciones de salud impactan en la salud bucal.

Así, nuestro análisis no solo ayuda a esclarecer la estructura de los datos y la relación entre diversas condiciones de salud, sino que también facilita el entendimiento de los factores de riesgo que afectan en la salud bucal.

# Marco metodológico

Para desarrollar un marco metodológico que explique el análisis de correspondencia simple con múltiples entradas y tablas concatenadas, así como el análisis de correspondencias múltiples (MCA por sus siglas en inglés), puedes seguir la siguiente estructura:

1.  Introducción al Análisis de Correspondencia Simple (CA) El Análisis de Correspondencia Simple es una técnica de análisis multivariante utilizada para explorar y visualizar las relaciones entre dos variables categóricas. Esta técnica proporciona una representación gráfica de las categorías de las variables en un espacio de baja dimensión, generalmente bidimensional, de modo que las distancias entre puntos en este espacio reflejan las diferencias en el perfil de las categorías.

2.  Extensión a Múltiples Entradas y Tablas Concatenadas Cuando se tiene más de una tabla de contingencia o datos de diferentes fuentes que deben ser analizados conjuntamente, es posible concatenar estas tablas para formar una única tabla de datos antes de realizar el análisis. Esta concatenación permite realizar un CA sobre el conjunto de datos integrado, proporcionando una visión global de las relaciones entre categorías en todas las tablas. Esto es especialmente útil para comparar grupos o categorías que se miden a través de múltiples variables o en diferentes momentos en el tiempo.

3.  Análisis de Correspondencias Múltiples (MCA) El Análisis de Correspondencias Múltiples es una generalización del análisis de correspondencia simple aplicable a tablas de datos que contienen más de dos variables categóricas. El objetivo del MCA es analizar la estructura de las relaciones entre varias categorías de múltiples variables categóricas y visualizar estas relaciones en un espacio multidimensional.

El MCA trata cada modalidad de las variables categóricas como una categoría independiente y las representa en un espacio factorial, donde la proximidad entre categorías indica una asociación o similitud en los perfiles de los individuos que seleccionaron estas categorías.

```{r}
#| output: false
library(factoextra)
library(gridExtra)
library(tidyverse)
library(FactoMineR)
library(vcd)
library(ca)
library(knitr)
```

# Carga de datos y limpieza

```{r}
load('./data/bfm.RData')
```

Se cargan 3 dataframes : datos , DATOS y dato01.601

```{r}
datos = datos %>% select(-c(17:22 , 28)) %>% filter(!if_any(c(1:23), is.na))
```

Se borran los individuos que tienen edad mayor a 34 años y que pertenecen al grupo de 18-34 años

```{r}
#| output: false
datos %>% group_by(edadrec2) %>% select(edad) %>% summarise(rango = range(edad)) %>% kable()


```

```{r}
datos = datos %>% filter(! (edadrec2 == 1 & edad > 34))
```

```{r}
datos2 <- datos %>% mutate(across(where(is.factor), ~ as.integer(.)))
datos2 = datos2 %>% select(-c(ingresos , edad,niveledu.rec))
datos2 = datos2 %>% rename(ingresos = ingresos.rec , edad = edadrec2)
```

```{r}
#| warning: false
#| output: false
datos %>% group_by(edadrec2) %>% select(edad) %>% summarise(rango = range(edad)) %>% kable()

```

```{r , results='asis'}
#| label: tbl-tabla1
#| tbl-cap: "Rangos etarios" 
a = c("E1" , "E2" , "E3" , "E4" , "E5")
b = c('18-34' , '35-44' , '45-54' , '55-64' , '65-85')
c = as.data.frame(cbind(a,b))
names(c) = c("Grupo" , "Rango etario")
kable(c)

```

# Análisis de corespondencia simple

## Multiples entradas

```{r}
datos2$V8_9 <- 2*(datos2$V8-1)+datos2$V9
datos2$V8_10 <- 2*(datos2$V8_9-1)+datos2$V10
datos2$V8_11 <- 2*(datos2$V8_10-1)+datos2$V11
tab_ing <- table(datos2$V8_11,  datos2$ingresos)
```

```{r}
#| output: false

#V8_11 y educación
tab_educ <- table(datos2$V8_11,  datos2$niveledu)
#tab_educ
colnames(tab_educ) <- c('BC','BI','CBC','CBI','EP','ET', "EU" ,"PC" ,"PI" ,"SEF")
rownames(tab_educ) <- c("nada", "P", "C", "CP", "D", "DP", "DC", "DCP", "B", "BP", "BC", "BCP", "BD", "BDP", "BDC", "BDCP")

catab_educ_ <- CA(tab_educ, col.sup = c(5, 10))
# eig.val_educ <- get_eigenvalue(catab_educ_)
# eig.val_educ
```

```{r}
#| label: fig-plot1
#| fig-cap: "ACS con mutliples entradas , V8 a V11 y edad"
#fviz_eig(catab_educ_)

fviz_ca_biplot(catab_educ_, repel = TRUE,  col.row = "cos2",
               gradient.cols = c("#00AFBB", "#E7B800"), title = "Plano principal de las variables nivel educativo y V8 a V11")
```

Este gráfico representa el plano principal generado por las variables nivel educativo y V8 a 11. En esta parte del análisis las categorías de nivel educacional: "Sin escolarización formal" (SEF) y "Estudios de posgrado" (EP), únicamente intervienen como categorías suplementarias. Aquellos individuos con un nivel de estudio PI o PC (primaria incompleta y completa, respectivamente), suelen asociarse con la prevalenca de PIP y de caries. Por otro lado, el resto de categorías que no alcanzan estudios terciarios se encuentran más asociadas a la categoría de pérdida dentaria.

## Tablas concatenadas

```{r}
for(j in c(12,13,14,20)){
  stemp<-table(datos2[,j],datos2[,8])
  for(i in 9:11){
    stemp<-cbind(stemp,table(datos2[,j],datos2[,i]))
  }
  if(j==12){stackalguna<-stemp}else{stackalguna<-rbind(stackalguna,stemp)}
}
rm(stemp)

colnames(stackalguna)<-c("8s","8n","9s","9n","10s","10n","11s","11n")
#Ver rec de edades
rownames(stackalguna)<-c("F","M","BC","BI","CB","CBI","EP","ET","EU",
"PC","PI","SEF","0-17","17-24","24-32","32-40",
"+40","NS/NC","E1","E2","E3","E4","E5")
```

```{r}
for(j in c(12,13,14,20)){
  stemp<-table(datos2[,j],datos2[,1])
  for(i in 2:11){
    stemp<-cbind(stemp,table(datos2[,j],datos2[,i]))
  }
  if(j==12){stacktodo<-stemp}else{stacktodo<-rbind(stacktodo,stemp)}
}
rm(stemp)

colnames(stacktodo)<-c("1s","1n","2s","2n","3s","3n","4s","4n",
"5n","5s","6s","6n","7s","7n","8s","8n","9s","9n","10s","10n","11s","11n")
#Ver rec de edades, ingresos tiene 6 lvls pero 7
rownames(stacktodo)<-c("F","M","BC","BI","CB","CBI","EP","ET","EU",
"PC","PI","SEF","0-17","17-24","24-32","32-40","+40","NS/NC","E1","E2","E3","E4","E5")
```

```{r}
#| label: fig-plot2
#| fig-cap: "ACS con tabla concatenada"
plot(ca(stackalguna), main="Plano principal: tabla concatenada")

```

En el eje principal se nota como las variables E se encuentran ordenadas , lo quiere decir que la mayoria de la variablidad en el eje 1 queda explicada por la edad. En el eje 2 , quedan arriba los s y abajo los n , lo que significa que hay una division clara entre tener problemas odontológicos y no tenerlos. Las personas que no tienen educación formal se encuentran en el cuadrante superior, lo que da a entder que estas personas tienden a tener problemas odontológicos. Otro punto importante a destacar es que la prevalencia de pip y prevalencia de bolsa se encuentran sobretodo en la gente con menor edad. Por otro lado la gente con mayor edad tiende a tener perdida de dientes.

```{r}
#| label: fig-plot3
#| fig-cap: " ACS con tabla concatenada"
plot(ca(stacktodo))

```

Lo primero que se puede notar de igual forma que en el analisis anterior es que la edad es la variable que mas explica la variabilidad en el eje 1. En el eje 2 se puede notar que las personas con problemas odontológicos tienden a tener problemas de salud general. Por otro lado las personas con problemas de salud general tienden a tener problemas de salud general. En el cuadrante superior izquierdo se encuentran las personas con problemas de salud general y problemas odontológicos. En el cuadrante inferior derecho se encuentran las personas que no tienen problemas de salud general ni problemas odontológicos. En el cuadrante superior derecho se encuentran las personas con problemas de salud general pero sin problemas odontológicos. En el cuadrante inferior izquierdo se encuentran las personas con problemas odontológicos pero sin problemas de salud general.

\newpage

# Análisis de Correspondencias Múltiples

```{r}
#| output: false
mca811 = MCA(datos %>% select(8:11) %>% mutate(across(where(is.numeric), ~ as.factor(.))))
```

```{r}
#| label: fig-plot4
#| fig-cap: "Análisis de corresponedia múltiple de de V8 a V11"
fviz_mca_var(mca811, repel = TRUE , col.var = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"))
```

En el Análisis de Correspondencias Múltiples realizado, los ejes identificados ofrecen una visión clara sobre las diferencias significativas entre las variables estudiadas, cada una relacionada con aspectos específicos de la salud dental. El primer eje, que explica un 40.23% de la variabilidad, destaca por su capacidad para diferenciar entre las respuestas asociadas con la variable V8 (Prev. bolsa 3 Odontológicas) y V11 (Prevalencia de PIP). Esta distinción podría indicar que la presencia o ausencia de condiciones más graves o específicas, como las bolsas periodontales y las condiciones designadas por "PIP", son factores distintivos críticos.

Por otro lado, el segundo eje, que captura el 23.63% de la variación, muestra una separación clara con respecto a la variable V10 (Prevalencia de Caries). Esto indica que las caries dentales exhiben un patrón de variabilidad que es distintivamente diferente en comparación con otras condiciones dentales evaluadas. La prevalencia de caries puede estar influenciada por factores de riesgo únicos que no son tan prominentes en otras condiciones periodontales o dentales evaluadas, resaltando la necesidad de abordajes diferenciados en las estrategias de salud dental.

```{r}
#| output: false
mca47 = MCA(datos%>% select(4:7)%>% mutate(across(where(is.numeric), ~ as.factor(.))))
```

\newpage

```{r}
#| label: fig-plot5
#| fig-cap: "Análisis de corresponedia múltiple de de V4 a V7"
fviz_mca_var(mca47, repel = TRUE , col.var = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"))

```

El primer eje vendria a reprsentar las condiciones relacionadas al sobre peso y obesidad ya que se observan que la razon cintrua cadera se encuentra muy cerca de la variable de sobrepeso y obesidad. El segundo eje no se tiene tan claro la agrupacion de las variables ya que se encuentran muy dispersas. Tambien se observa una diferencia respecto a la variable de sobrepeso y obesidad en el segundo eje. Quizas podria representar la salud en general de las personas.

\newpage

```{r}
#| output: false
MCA(datos %>% select(1:3)%>% mutate(across(where(is.numeric), ~ as.factor(.))))
```

```{r}
#| output: false
pca_results = PCA(datos %>% select(edad, , S, C, P, O))
```

```{r}
#| label: fig-plot6
#| fig-cap: "PCA de la edad con variables odontológicas"
fviz_pca_var(pca_results, col.var = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"))
```

No hay nada muy revelador en el PCA, quizas lo que mas llame la atencion como se openen la cantidad de dientes operados a la cantidad de dientes con caries. Se toma a las variables S,C,P,O como numéricas para ver como se relacionan con la edad. No es necesario tomar CPO ya que es una combinación lineal de las otras, no agrega información al PCA.

```{r}
dummy_matrix <- model.matrix(~ . + 0, data = datos2 %>% select(8:11))
burt_table <- t(dummy_matrix) %*% dummy_matrix
```

# Notas

Se analizan las variables 8 a 11 con la edad

```{r}
tab_edad <- table(datos2$V8_11,  datos2$edad)
rownames(tab_edad) <- c("nada", "P", "C", "CP", "D", "DP",
                        "DC", "DCP", "B", "BP", "BC", "BCP", "BD", "BDP", "BDC", "BDCP")

catab_edad <- CA(tab_edad)

# Valores propios
# eig.val_edad <- get_eigenvalue(catab_edad)
# eig.val_edad

fviz_eig(catab_edad)

fviz_ca_biplot(catab_edad, repel = TRUE,  col.row = "cos2",
               gradient.cols = c("#00AFBB", "#E7B800"), title = "Plano principal de las variables edad y V8 a V11")

#"#00AFBB", "#E7B800", "#FC4E07"
```

Se observa que la variable que mejor representada está en el eje 1 es la edad, encontrándose hacia la izquierda del gráfico las personas de mayor edad. La mayoría de las categorías de las variables odontológicas que se encuentran bien representadas en este plano principal. Se observa que los jóvenes de menor edad presentan perdida dentaria y los de mayor edad tienden a presentar mayormente prevalencia de PIP. Es interesantes que este mismo rango etáreo es el que más cercano está a no tener ningún problema de tipo odontológico.

# Conclusiones

1.  Relación entre nivel educativo y salud bucal: El Análisis de Correspondencias Múltiples muestra una asociación entre individuos con niveles educativos básicos (primaria incompleta y completa) y la prevalencia de condiciones odontológicas específicas, PIP y caries. Este vínculo sugiere que menores niveles de educación pueden estar relacionados con una mayor incidencia de ciertos problemas dentales, mientras que la pérdida dentaria aparece asociada de manera más general a niveles educativos no terciarios.

2.  Influencia de la edad en la salud bucal: Los resultados indican que la edad es un determinante de la variabilidad en las condiciones odontológicas y de salud general. Las personas más jóvenes tienden a sufrir de condiciones como la prevalencia de bolsa y PIP, mientras que la pérdida dentaria es más frecuente en individuos de mayor edad.

3.  Diferenciación de problemas odontológicos y de salud general: El análisis revela una división clara entre tener problemas odontológicos y no tenerlos, así como entre problemas de salud general y odontológicos.

4.  Patrones de enfermedades dentales y su relación con otras condiciones de salud: Los ejes identificados en el Análisis de Correspondencias Múltiples proporcionan una visión clara sobre cómo distintas condiciones odontológicas, como bolsas periodontales y caries, presentan patrones de variabilidad que difieren significativamente entre sí. Esto resalta la necesidad de abordajes diferenciados en las estrategias de salud dental, considerando los factores de riesgo únicos que cada condición presenta.

    En conclusión, estos hallazgos subrayan la importancia de considerar una variedad de factores, incluyendo el nivel educativo, la edad, y las condiciones de salud general, al evaluar la salud bucal.
